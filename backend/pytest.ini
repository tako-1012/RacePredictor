[tool:pytest]
# pytest設定ファイル
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# マーカー設定
markers =
    unit: 単体テスト
    integration: 統合テスト
    performance: パフォーマンステスト
    accuracy: 精度検証テスト
    error_handling: エラーハンドリングテスト
    ai: AI機能テスト
    slow: 実行時間の長いテスト
    requires_redis: Redisが必要なテスト
    requires_celery: Celeryが必要なテスト
    requires_ml: 機械学習ライブラリが必要なテスト

# テスト実行設定
addopts = 
    -v
    --tb=short
    --strict-markers
    --disable-warnings
    --color=yes
    --durations=10
    --maxfail=5
    --cov=app
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    --cov-fail-under=80

# 非同期テスト設定
asyncio_mode = auto

# テストフィルタリング
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning:sklearn.*
    ignore::UserWarning:numpy.*
    ignore::UserWarning:pandas.*

# テスト実行環境
env =
    TESTING = true
    AI_FEATURES_ENABLED = true
    REDIS_URL = redis://localhost:6379/1
    CELERY_BROKER_URL = redis://localhost:6379/1
    CELERY_RESULT_BACKEND = redis://localhost:6379/1
    ML_MODEL_PATH = ./models
    LOG_LEVEL = DEBUG

# テストタイムアウト設定
timeout = 300

# テスト並列実行設定
# -n auto で自動的に並列実行
# pytest-xdist が必要
# addopts = -n auto

# テスト結果レポート設定
junit_family = xunit2
junit_logging = all
junit_log_passing_tests = true
