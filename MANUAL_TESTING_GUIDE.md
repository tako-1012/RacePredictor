# RacePredictor 手動テストガイド

## 📋 テスト概要

このガイドは、RacePredictorアプリケーションのローカル環境での手動テストを実施するための詳細な手順書です。基本機能からUI/UX、CSVインポートまで、すべての機能を体系的にテストできます。

## 🚀 ローカル環境起動

### 前提条件
- Python 3.11以上
- Node.js 18以上
- PostgreSQL（またはSQLite）

### 1. バックエンド起動

```bash
# 方法1: 起動スクリプト使用（推奨）
./start_backend.sh

# 方法2: 手動起動
cd backend
source venv/bin/activate
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**確認ポイント:**
- ✅ ポート8000でサーバーが起動
- ✅ API ドキュメント: http://localhost:8000/docs にアクセス可能
- ✅ ヘルスチェック: http://localhost:8000/health で200レスポンス

### 2. フロントエンド起動

```bash
# 方法1: 起動スクリプト使用（推奨）
./start_frontend.sh

# 方法2: 手動起動
cd frontend-react
npm run dev
```

**確認ポイント:**
- ✅ ポート3000でサーバーが起動
- ✅ フロントエンド: http://localhost:3000 にアクセス可能
- ✅ バックエンドAPIとの接続確認

### 3. 全サーバー一括起動

```bash
# バックエンド（バックグラウンド）+ フロントエンド（フォアグラウンド）
./start.sh
```

---

## 🧪 基本機能テスト

### 1. ユーザー登録・ログイン

#### 1.1 新規ユーザー登録

**テスト手順:**
1. http://localhost:3000 にアクセス
2. 「新規登録」をクリック
3. 以下の情報を入力:
   ```
   メールアドレス: test@example.com
   パスワード: TestPassword123!
   確認パスワード: TestPassword123!
   ```
4. 「登録」ボタンをクリック

**期待する動作:**
- ✅ 登録成功メッセージが表示
- ✅ 自動的にログイン状態になる
- ✅ ダッシュボードにリダイレクト

**確認すべきポイント:**
- パスワード強度チェック（8文字以上、大文字・小文字・数字・記号）
- メールアドレス形式バリデーション
- 重複メールアドレス登録の防止

#### 1.2 ログイン

**テスト手順:**
1. ログアウト状態で「ログイン」をクリック
2. 登録したメールアドレスとパスワードを入力
3. 「ログイン」ボタンをクリック

**期待する動作:**
- ✅ ログイン成功
- ✅ ダッシュボードにリダイレクト
- ✅ ナビゲーションバーにユーザー名表示

**確認すべきポイント:**
- 間違ったパスワードでのエラーハンドリング
- 存在しないメールアドレスでのエラーハンドリング
- ログイン状態の永続化（ページリロード後もログイン状態維持）

#### 1.3 ログアウト

**テスト手順:**
1. ログイン状態でナビゲーションバーの「ログアウト」をクリック

**期待する動作:**
- ✅ ログアウト成功
- ✅ ログインページにリダイレクト
- ✅ トークンがクリアされる

### 2. プロフィール設定・自己ベスト登録

#### 2.1 ユーザープロフィール設定

**テスト手順:**
1. ダッシュボードから「プロフィール設定」にアクセス
2. 以下の情報を入力:
   ```
   年齢: 25
   性別: 男性
   身長: 170cm
   体重: 65kg
   安静時心拍数: 60bpm
   最大心拍数: 195bpm
   VO2max: 45.0 (任意)
   ```
3. 「保存」ボタンをクリック

**期待する動作:**
- ✅ プロフィール情報が保存される
- ✅ BMIが自動計算される（22.5）
- ✅ ダッシュボードに反映される

**確認すべきポイント:**
- 数値入力のバリデーション（負の値、異常値の拒否）
- BMI自動計算の正確性
- 必須項目のバリデーション

#### 2.2 自己ベスト登録

**テスト手順:**
1. 「自己ベスト」ページにアクセス
2. 「新規登録」をクリック
3. 以下の情報を入力:
   ```
   種目: 5000m
   タイム: 18:30
   達成日: 2024-01-15
   大会名: テスト大会
   ```
4. 「保存」ボタンをクリック

**期待する動作:**
- ✅ 自己ベストが登録される
- ✅ 一覧に表示される
- ✅ ダッシュボードの統計に反映される

**確認すべきポイント:**
- タイム形式のバリデーション（mm:ss または hh:mm:ss）
- 日付の妥当性チェック
- 重複種目の登録制御

### 3. 練習記録の作成・編集・削除

#### 3.1 基本練習記録作成

**テスト手順:**
1. 「練習記録」ページにアクセス
2. 「新規作成」をクリック
3. 以下の情報を入力:
   ```
   日付: 今日の日付
   部練習数: 1部練
   セッション1:
     - ウォームアップ: 10分ジョギング
     - メイン練習: 1000m×5本（レスト3分）
     - クールダウン: 10分ジョギング
   天候: 晴れ
   気温: 20℃
   メモ: テスト練習
   ```
4. 「保存」ボタンをクリック

**期待する動作:**
- ✅ 練習記録が作成される
- ✅ 一覧に表示される
- ✅ ダッシュボードの統計に反映される

**確認すべきポイント:**
- 複数セッション（2部練、3部練）の対応
- インターバル詳細の記録
- 心拍数データの入力

#### 3.2 インターバル詳細記録

**テスト手順:**
1. 練習記録作成時に「インターバル詳細」をクリック
2. 以下の情報を入力:
   ```
   セット1: 1000m, 4:00, ペース4:00/km, 心拍数150-160bpm
   レスト: 3分完全休息, 心拍数回復率80%
   セット2: 1000m, 3:58, ペース3:58/km, 心拍数155-165bpm
   レスト: 3分完全休息, 心拍数回復率75%
   ```
3. 「保存」ボタンをクリック

**期待する動作:**
- ✅ インターバル詳細が記録される
- ✅ ラップスプリットが表示される
- ✅ 心拍数データが可視化される

#### 3.3 練習記録編集・削除

**テスト手順:**
1. 作成した練習記録の「編集」ボタンをクリック
2. 内容を修正して「保存」
3. 「削除」ボタンをクリックして確認

**期待する動作:**
- ✅ 編集内容が反映される
- ✅ 削除確認ダイアログが表示される
- ✅ 削除後、一覧から消える

### 4. レース結果の作成・編集・削除

#### 4.1 レース結果記録

**テスト手順:**
1. 「レース結果」ページにアクセス
2. 「新規作成」をクリック
3. 以下の情報を入力:
   ```
   大会名: テストマラソン大会
   日付: 2024-02-15
   場所: 東京
   種目: フルマラソン
   記録: 3:30:00
   順位: 100位
   参加者数: 1000人
   天候: 晴れ
   気温: 15℃
   スプリット: 5km: 25:00, 10km: 50:00, ハーフ: 1:45:00
   戦略: 前半抑えめ、後半スパート
   反省点: 給水タイミングが遅かった
   ```
4. 「保存」ボタンをクリック

**期待する動作:**
- ✅ レース結果が記録される
- ✅ 自己ベストが自動更新される（該当する場合）
- ✅ ダッシュボードに反映される

**確認すべきポイント:**
- タイム形式のバリデーション
- スプリット記録の詳細入力
- 環境条件の記録

#### 4.2 レース結果編集・削除

**テスト手順:**
1. 作成したレース結果の「編集」ボタンをクリック
2. 内容を修正して「保存」
3. 「削除」ボタンをクリックして確認

**期待する動作:**
- ✅ 編集内容が反映される
- ✅ 削除確認ダイアログが表示される
- ✅ 削除後、一覧から消える

### 5. レース予定の管理

#### 5.1 レース予定登録

**テスト手順:**
1. 「レース予定」ページにアクセス
2. 「新規作成」をクリック
3. 以下の情報を入力:
   ```
   大会名: 春のマラソン大会
   日付: 2024-04-15
   場所: 大阪
   種目: ハーフマラソン
   目標タイム: 1:30:00
   ステータス: 準備中
   ```
4. 「保存」ボタンをクリック

**期待する動作:**
- ✅ レース予定が登録される
- ✅ カウントダウンが表示される
- ✅ ダッシュボードに反映される

**確認すべきポイント:**
- 未来の日付のみ受け付ける
- カウントダウン表示の正確性
- ステータス管理（準備中→完了）

#### 5.2 レース予定完了

**テスト手順:**
1. レース予定の「完了」ボタンをクリック
2. 実際の記録を入力
3. 「完了」ボタンをクリック

**期待する動作:**
- ✅ レース予定が完了ステータスになる
- ✅ レース結果が自動生成される
- ✅ 自己ベストが更新される（該当する場合）

### 6. カスタムワークアウトテンプレート作成・使用

#### 6.1 テンプレート作成

**テスト手順:**
1. 「カスタムワークアウト」ページにアクセス
2. 「テンプレート作成」をクリック
3. 以下の情報を入力:
   ```
   テンプレート名: 1000m×5本インターバル
   説明: 持久力向上用のインターバル練習
   セット構成:
     - ウォームアップ: 15分ジョギング
     - メイン: 1000m×5本（レスト3分）
     - クールダウン: 15分ジョギング
   目標ペース: 4:00/km
   心拍ゾーン: Zone 4-5
   ```
4. 「保存」ボタンをクリック

**期待する動作:**
- ✅ テンプレートが作成される
- ✅ 一覧に表示される
- ✅ 再利用可能になる

#### 6.2 テンプレート使用

**テスト手順:**
1. 作成したテンプレートの「使用」ボタンをクリック
2. 日付と詳細を入力
3. 「練習記録として保存」をクリック

**期待する動作:**
- ✅ テンプレート内容が練習記録にコピーされる
- ✅ カスタマイズ可能
- ✅ 練習記録として保存される

---

## 🎨 UI/UXテスト

### 1. ナビゲーション動作

#### 1.1 メインナビゲーション

**テスト手順:**
1. 各ページ間を移動
2. ブラウザの戻る・進むボタンを使用
3. 直接URL入力でアクセス

**確認すべきポイント:**
- ✅ ナビゲーションバーの一貫性
- ✅ アクティブページのハイライト
- ✅ ログイン状態の維持
- ✅ 404エラーページの表示

#### 1.2 レスポンシブナビゲーション

**テスト手順:**
1. ブラウザ幅を変更（デスクトップ→タブレット→スマートフォン）
2. ハンバーガーメニューの動作確認

**確認すべきポイント:**
- ✅ モバイルメニューの表示/非表示
- ✅ タッチ操作の対応
- ✅ メニュー項目の可読性

### 2. レスポンシブデザイン確認

#### 2.1 デスクトップ表示（1200px以上）

**確認すべきポイント:**
- ✅ サイドバーナビゲーション
- ✅ 2カラムレイアウト
- ✅ ホバーエフェクト
- ✅ マウス操作の最適化

#### 2.2 タブレット表示（768px-1199px）

**確認すべきポイント:**
- ✅ 適切なカラム調整
- ✅ タッチ操作の最適化
- ✅ フォントサイズの調整
- ✅ ボタンサイズの最適化

#### 2.3 スマートフォン表示（767px以下）

**確認すべきポイント:**
- ✅ 1カラムレイアウト
- ✅ ハンバーガーメニュー
- ✅ タッチフレンドリーなUI
- ✅ スクロール操作の最適化

### 3. フォーム入力・バリデーション

#### 3.1 入力フィールドテスト

**テスト手順:**
1. 各フォームで無効なデータを入力
2. 必須項目を空のまま送信
3. 文字数制限を超える入力

**確認すべきポイント:**
- ✅ リアルタイムバリデーション
- ✅ エラーメッセージの表示
- ✅ フォーカス管理
- ✅ 入力補助機能

#### 3.2 日付・時刻入力

**テスト手順:**
1. 日付ピッカーで無効な日付を選択
2. 時刻入力で無効な形式を入力
3. 未来の日付制限の確認

**確認すべきポイント:**
- ✅ 日付ピッカーの動作
- ✅ 時刻形式のバリデーション
- ✅ 日付制限の適用
- ✅ タイムゾーン対応

### 4. エラー表示・ハンドリング

#### 4.1 ネットワークエラー

**テスト手順:**
1. バックエンドを停止
2. フロントエンドでAPI呼び出しを実行
3. ネットワークを復旧

**確認すべきポイント:**
- ✅ エラーメッセージの表示
- ✅ リトライ機能
- ✅ オフライン状態の表示
- ✅ 復旧時の自動再接続

#### 4.2 認証エラー

**テスト手順:**
1. トークンの有効期限切れをシミュレート
2. 無効なトークンでAPI呼び出し
3. 権限不足の操作を実行

**確認すべきポイント:**
- ✅ 自動ログアウト
- ✅ ログインページへのリダイレクト
- ✅ エラーメッセージの表示
- ✅ セッション管理

---

## 📊 CSVインポートテスト

### 1. 練習用CSVインポート

#### 1.1 基本インポート

**テスト手順:**
1. 「練習記録」→「CSVインポート」をクリック
2. `test_workout_data.csv` を選択
3. プレビューを確認
4. インポート設定を入力:
   ```
   練習日: 今日の日付
   練習種別: インターバル走
   強度: 4
   ```
5. 「インポート実行」をクリック

**期待する動作:**
- ✅ プレビューが正しく表示される
- ✅ 練習記録が作成される
- ✅ 一覧に表示される

**確認すべきポイント:**
- エンコーディング自動判定
- カラムマッピングの正確性
- データ型変換の正確性

#### 1.2 Garmin Connect CSV

**テスト手順:**
1. `activity_20370061025.csv` を選択
2. プレビューでデータ構造を確認
3. インポート設定を調整
4. インポート実行

**期待する動作:**
- ✅ 28カラム対応
- ✅ 練習種別自動推定
- ✅ 心拍数データの取り込み

**確認すべきポイント:**
- 文字化けの防止
- データ欠損の処理
- 異常値の検出

### 2. レース用CSVインポート

#### 2.1 レース結果インポート

**テスト手順:**
1. 「レース結果」→「CSVインポート」をクリック
2. レース結果CSVファイルを選択
3. カラムマッピングを設定
4. デフォルト設定を入力:
   ```
   デフォルト種目: ロード
   デフォルトステータス: 完了
   ```
5. 「インポート実行」をクリック

**期待する動作:**
- ✅ レース結果が一括登録される
- ✅ 自己ベストが自動更新される
- ✅ 統計に反映される

### 3. エンコーディング対応確認

#### 3.1 文字化けテスト

**テスト手順:**
1. 異なるエンコーディングのCSVファイルを準備
2. 各ファイルでインポートテスト
3. プレビューで文字化けを確認

**確認すべきポイント:**
- ✅ UTF-8対応
- ✅ Shift_JIS対応
- ✅ EUC-JP対応
- ✅ 自動エンコーディング判定

#### 3.2 エラーハンドリング

**テスト手順:**
1. 無効なCSVファイルをアップロード
2. 空のCSVファイルをアップロード
3. 巨大なCSVファイルをアップロード

**確認すべきポイント:**
- ✅ 適切なエラーメッセージ
- ✅ ファイルサイズ制限
- ✅ フォーマット検証

---

## 🔍 詳細テスト項目

### 1. パフォーマンステスト

#### 1.1 ページロード時間

**テスト手順:**
1. ブラウザの開発者ツールを開く
2. Network タブで各ページのロード時間を測定
3. 3秒以内のロードを確認

**確認すべきポイント:**
- ✅ 初期ロード: 3秒以内
- ✅ ページ遷移: 1秒以内
- ✅ API レスポンス: 2秒以内

#### 1.2 大量データ処理

**テスト手順:**
1. 100件以上の練習記録を作成
2. 一覧表示のパフォーマンスを確認
3. ページネーションの動作を確認

**確認すべきポイント:**
- ✅ 一覧表示の高速化
- ✅ ページネーションの動作
- ✅ 検索・フィルタリングの性能

### 2. セキュリティテスト

#### 2.1 認証・認可

**テスト手順:**
1. ログアウト状態でAPI直接呼び出し
2. 無効なトークンでのアクセス
3. 他ユーザーのデータアクセス試行

**確認すべきポイント:**
- ✅ 401 Unauthorized レスポンス
- ✅ 403 Forbidden レスポンス
- ✅ データ分離の確認

#### 2.2 入力値検証

**テスト手順:**
1. SQLインジェクション攻撃のシミュレート
2. XSS攻撃のシミュレート
3. 無効なファイルアップロード

**確認すべきポイント:**
- ✅ 入力値サニタイゼーション
- ✅ ファイルタイプ検証
- ✅ サイズ制限の適用

### 3. データ整合性テスト

#### 3.1 関連データの整合性

**テスト手順:**
1. 自己ベストを更新
2. 関連するレース結果の整合性を確認
3. 統計データの再計算を確認

**確認すべきポイント:**
- ✅ データの一貫性
- ✅ 統計の正確性
- ✅ 関連データの更新

#### 3.2 データ永続化

**テスト手順:**
1. データを入力・保存
2. サーバーを再起動
3. データの永続化を確認

**確認すべきポイント:**
- ✅ データの永続化
- ✅ トランザクション処理
- ✅ バックアップ・復旧

---

## 📝 テスト結果記録

### テスト結果テンプレート

```markdown
## テスト実施日: YYYY-MM-DD
## テスト実施者: [名前]
## テスト環境: [OS/ブラウザ/バージョン]

### 基本機能テスト
- [ ] ユーザー登録・ログイン
- [ ] プロフィール設定・自己ベスト登録
- [ ] 練習記録の作成・編集・削除
- [ ] レース結果の作成・編集・削除
- [ ] レース予定の管理
- [ ] カスタムワークアウトテンプレート作成・使用

### UI/UXテスト
- [ ] ナビゲーション動作
- [ ] レスポンシブデザイン確認
- [ ] フォーム入力・バリデーション
- [ ] エラー表示・ハンドリング

### CSVインポートテスト
- [ ] サンプルファイルでのインポート確認
- [ ] エンコーディング対応確認

### 発見した問題
1. [問題の詳細]
2. [問題の詳細]

### 改善提案
1. [改善提案]
2. [改善提案]
```

---

## 🚨 トラブルシューティング

### よくある問題と解決方法

#### 1. バックエンドが起動しない

**症状:** ポート8000でエラーが発生
**解決方法:**
```bash
# 既存プロセスを確認
lsof -i :8000

# プロセスを停止
pkill -f uvicorn

# 再起動
./start_backend.sh
```

#### 2. フロントエンドが起動しない

**症状:** ポート3000でエラーが発生
**解決方法:**
```bash
# 既存プロセスを確認
lsof -i :3000

# プロセスを停止
pkill -f next

# 再起動
./start_frontend.sh
```

#### 3. データベース接続エラー

**症状:** データベース接続が失敗
**解決方法:**
```bash
# データベース設定を確認
cd backend
source venv/bin/activate
python -c "from app.core.database import engine; print('DB接続OK')"

# マイグレーション実行
alembic upgrade head
```

#### 4. CSVインポートエラー

**症状:** CSVファイルが読み込めない
**解決方法:**
- ファイルエンコーディングを確認
- ファイル形式を確認
- ファイルサイズを確認（10MB以下）

---

## 📞 サポート

### テスト中に問題が発生した場合

1. **ログの確認**
   ```bash
   # バックエンドログ
   tail -f logs/backend.log
   
   # フロントエンドログ（ブラウザコンソール）
   ```

2. **エラーレポートの作成**
   - 問題の詳細な説明
   - 再現手順
   - エラーメッセージ
   - 環境情報

3. **連絡先**
   - GitHub Issues
   - 開発者への直接連絡

---

**最終更新:** 2024年12月19日  
**バージョン:** RacePredictor v2.1  
**テスト対象:** ローカル開発環境
