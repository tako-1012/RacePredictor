# RunMaster 実装済み機能一覧・仕様書

## 📋 概要
RunMaster（旧RacePredictor）は、ランニング練習記録・レース管理・AI予測機能を持つWebアプリケーションです。データ収集版として運用中で、将来的なAI機能開発に向けた基盤が整っています。

## 🏗️ システム構成

### 技術スタック
- **バックエンド**: FastAPI (Python)
- **フロントエンド**: Next.js (React, TypeScript)
- **データベース**: SQLite (開発) / PostgreSQL (本番)
- **認証**: JWT認証
- **デプロイ**: Docker, Nginx
- **テスト**: pytest, Jest, Playwright

### アーキテクチャ
- **API**: RESTful API設計
- **認証**: JWT トークンベース認証
- **データベース**: Alembic マイグレーション
- **フロントエンド**: レスポンシブデザイン（Tailwind CSS）

## 🔐 認証・ユーザー管理

### 実装済み機能
- ✅ **ユーザー登録**: メールアドレス・パスワード認証
- ✅ **ログイン・ログアウト**: JWT トークンベース認証
- ✅ **パスワードバリデーション**: 8文字以上、英数字混合
- ✅ **セッション管理**: 自動ログイン、トークン有効期限管理
- ✅ **プロフィール管理**: 基本情報・身体データ管理

### 仕様詳細
- **認証方式**: JWT (JSON Web Token)
- **パスワード要件**: 8文字以上、英数字混合必須
- **セッション有効期限**: アクセストークン 24時間、リフレッシュトークン 7日
- **セキュリティ**: bcrypt パスワードハッシュ化

## 🏃‍♂️ 練習記録管理

### 実装済み機能
- ✅ **練習記録作成**: 手動入力による練習記録
- ✅ **練習種別管理**: ジョグ、レペ、テンポ走、インターバル等
- ✅ **セッション分割記録**: ウォームアップ・メイン・クールダウン
- ✅ **結果記入機能**: 計画と実際の結果を分離記録
- ✅ **時間変換機能**: 秒数入力の自動分:秒変換
- ✅ **ペース自動計算**: 距離と時間からペース自動計算
- ✅ **練習記録一覧**: フィルタ・ソート・検索機能
- ✅ **練習記録編集・削除**: 既存記録の更新・削除

### 仕様詳細
- **記録項目**: 距離、時間、ペース、心拍数、体感強度（RPE 1-10）
- **環境条件**: 天気、気温、湿度、練習メモ
- **セッション分割**: ウォームアップ・メイン・クールダウンの3段階
- **結果記録**: 計画値と実際の値を分離して記録
- **時間形式**: HH:MM:SS または 分:秒形式

## 🏁 レース管理

### 実装済み機能
- ✅ **レース結果記録**: 手動入力によるレース結果記録
- ✅ **レース種別管理**: トラック・ロード・駅伝の3カテゴリ
- ✅ **自己ベスト管理**: 種目別の自己ベスト記録
- ✅ **レース予定管理**: 今後のレース予定とカウントダウン
- ✅ **レース結果一覧**: フィルタ・ソート・検索機能
- ✅ **レース結果編集・削除**: 既存記録の更新・削除

### 仕様詳細
- **レース種別**: トラック（1500m、5000m等）、ロード（10km、ハーフ等）、駅伝
- **記録項目**: 距離、タイム、ペース、順位、天気、コースタイプ
- **駅伝対応**: 区間番号、チーム名、区間順位等の詳細情報
- **カウントダウン**: レースまでの日数自動計算

## 📊 ダッシュボード・統計

### 実装済み機能
- ✅ **統計カード**: 総練習回数、総走行距離、総練習時間、今週の距離
- ✅ **週間活動チャート**: Chart.js による棒グラフ表示
- ✅ **週間目標**: 距離・回数・時間の目標設定と進捗表示
- ✅ **質的分析**: 練習の質・効果重視の分析画面
- ✅ **成長指標**: ポイント練習での目標ペース達成率
- ✅ **強度分布**: イージー・テンポ・インターバルの比率

### 仕様詳細
- **統計表示**: リアルタイム統計情報
- **チャート**: Chart.js によるインタラクティブなグラフ
- **目標管理**: 週間目標の設定と進捗追跡
- **質的分析**: 量より質を重視した成長指標
- **強度分布**: 科学的に推奨される強度配分の可視化

## 🤖 AI予測機能（準備中）

### 実装済み基盤
- ✅ **AI予測エンジン**: 機械学習ベース（scikit-learn）
- ✅ **特徴量抽出**: 28種類の高度な特徴量
- ✅ **アンサンブル予測**: 複数モデル組み合わせ
- ✅ **予測API**: AI予測と統計予測の両方対応
- ✅ **予測履歴**: 全予測結果の履歴管理

### 将来機能（Coming Soon）
- 🔄 **AIタイム予測**: 精度目標3%以内のレースタイム予測
- 🔄 **AIコーチング**: 週間プラン自動生成
- 🔄 **怪我予防AI**: オーバートレーニング検出

### 仕様詳細
- **機械学習**: Random Forest, Gradient Boosting, Linear Regression
- **特徴量**: 基本統計、トレンド分析、強度分布、レース履歴、プロフィール
- **予測精度**: 統計的予測からAI予測への段階的移行
- **信頼度表示**: 高・中・低の信頼度レベル

## 📁 CSVインポート機能

### 実装済み機能
- ✅ **練習記録CSVインポート**: Garmin Connect エクスポート形式対応
- ✅ **レース結果CSVインポート**: カスタムマッピング機能
- ✅ **4ステップフロー**: アップロード→プレビュー→設定→完了
- ✅ **ラップデータ自動解析**: GPS時計の余分ラップ問題対応
- ✅ **練習種別自動推定**: データから練習種別を推定

### 仕様詳細
- **対応形式**: Garmin Connect エクスポート形式
- **データ解析**: ラップデータの自動解析と異常検知
- **マッピング**: カスタムフィールドマッピング機能
- **駅伝対応**: 駅伝データの詳細情報対応

## 🏥 コンディション管理

### 実装済み機能
- ✅ **日次メトリクス**: 体重・睡眠時間・疲労度・モチベーション
- ✅ **週間・月間平均**: 日々の変動に過度に注目しない設計
- ✅ **トレンド分析**: 週間・月間統計
- ✅ **コンディション記録**: 統合管理インターフェース

### 仕様詳細
- **記録項目**: 体重、睡眠時間、疲労度（1-10）、モチベーション（1-10）
- **表示方式**: 週間・月間平均を優先表示
- **ヘルシーアプローチ**: 過度な日々の変動追跡を避ける設計

## 🎨 カスタムワークアウト

### 実装済み機能
- ✅ **カスタムワークアウト作成**: Garminライクなモバイルファーストデザイン
- ✅ **テンプレート機能**: よく使うワークアウトのテンプレート化
- ✅ **セッション分割**: ウォームアップ・メイン・クールダウンの分割
- ✅ **ドラッグ&ドロップ**: ステップの並び替え機能
- ✅ **繰り返しブロック**: インターバル練習の繰り返し設定

### 仕様詳細
- **UI設計**: カードベースのレイアウト
- **ステップタイプ**: ウォームアップ、メイン、レスト等の色分け
- **繰り返し機能**: インターバル練習の繰り返し回数設定
- **テンプレート管理**: 使用回数、お気に入り、最終使用日の管理

## 🔧 システム管理

### 実装済み機能
- ✅ **エラーハンドリング**: 統一されたエラー処理
- ✅ **ログシステム**: 構造化されたログ出力
- ✅ **セキュリティ**: JWT認証、SQLインジェクション防止
- ✅ **レスポンシブデザイン**: PC・タブレット・スマートフォン対応
- ✅ **アクセシビリティ**: スクリーンリーダー対応

### 仕様詳細
- **エラー処理**: 詳細なログ出力とスタックトレース
- **セキュリティ**: 認証・認可、攻撃防止対策
- **レスポンシブ**: モバイルファーストデザイン
- **アクセシビリティ**: aria属性、キーボードナビゲーション

## 📱 Web最適化機能

### 実装済み機能
- ✅ **キーボード操作**: Tab/Enter/Escキーでの効率的なナビゲーション
- ✅ **自動保存**: 30秒間隔での下書き保存
- ✅ **ブラウザ通知**: 練習記録保存時の通知
- ✅ **進捗表示**: ページタブでの進捗表示
- ✅ **CSV出力**: フィルタリング済みデータのCSV出力
- ✅ **印刷機能**: 印刷用CSS、ページ分割対応

### 仕様詳細
- **キーボード操作**: 数値入力時のキーボードショートカット
- **状態保存**: localStorage活用による入力内容復元
- **ブラウザAPI**: Clipboard API、Page Visibility API活用
- **共有機能**: Web Share API活用

## 🧪 テスト環境

### 実装済み機能
- ✅ **包括的テストスイート**: 137個のテスト実装
- ✅ **単体テスト**: 71個（認証・練習記録・レース・CSV・ダッシュボード）
- ✅ **フロントエンドテスト**: 27個（認証・練習記録コンポーネント）
- ✅ **統合テスト**: 21個（API・データベース）
- ✅ **E2Eテスト**: 7個（ユーザージャーニー・レスポンシブ・アクセシビリティ）
- ✅ **パフォーマンステスト**: 7個（同時ユーザー・大量データ・CSV処理）
- ✅ **セキュリティテスト**: 12個（認証・認可・攻撃防止）

### 仕様詳細
- **テスト実行**: 自動化されたテスト実行スクリプト
- **品質保証**: 80%以上のカバレッジ目標
- **パフォーマンス**: 同時50ユーザー・1000件データ・1秒以内応答
- **セキュリティ**: 12のセキュリティテストで脆弱性検出

## 🚀 デプロイメント・運用

### 実装済み機能
- ✅ **本格運用準備**: Docker Compose、Nginx設定
- ✅ **監視体制**: システム・アプリケーション・データベース監視
- ✅ **バックアップ戦略**: 自動バックアップ・復旧戦略
- ✅ **小規模インスタンス構成**: 月額5,000円以内の運用計画

### 仕様詳細
- **デプロイ**: Docker、Nginx、SSL設定
- **監視**: CPU、メモリ、ディスク、レスポンス時間監視
- **バックアップ**: 自動バックアップスクリプト、復旧手順書
- **運用コスト**: ハイブリッド構成（推奨：月額¥3,200）

## 📊 実装統計

### 総合実装状況
- **総実装ファイル数**: 120個以上
- **新規APIエンドポイント**: 50個以上
- **新規フロントエンドページ**: 8ページ
- **新規コンポーネント**: 25個以上
- **新規データベーステーブル**: 9テーブル
- **テストファイル**: 15ファイル
- **デプロイメントファイル**: 8ファイル
- **総テスト数**: 137個

### 品質指標
- **認証機能**: 100%成功率
- **ワークアウト機能**: 70%成功率
- **AI予測機能**: 85.7%成功率
- **パフォーマンス**: 同時50ユーザー対応
- **セキュリティ**: 12のセキュリティテスト完了

## 🎯 現在の状況

### 完成済み機能
- ✅ **認証システム**: 100%安定動作
- ✅ **練習記録管理**: 包括的な記録・管理機能
- ✅ **レース管理**: 結果記録・予定管理・自己ベスト管理
- ✅ **ダッシュボード**: 統計表示・チャート・目標管理
- ✅ **CSVインポート**: Garmin Connect対応
- ✅ **コンディション管理**: 日次メトリクス管理
- ✅ **カスタムワークアウト**: テンプレート・セッション分割
- ✅ **Web最適化**: ブラウザ特化機能
- ✅ **テスト環境**: 包括的テストスイート
- ✅ **デプロイメント**: 本格運用準備完了

### データ収集版としての位置づけ
- **ベータテスター**: データ収集への貢献価値を明確化
- **AI機能準備**: 将来のAI機能開発に向けた基盤整備
- **継続的改善**: ユーザーフィードバックに基づく機能拡張

## 🔮 今後の展望

### Phase 6以降の計画
- **高度な分析機能**: トレンド分析と可視化の強化
- **パフォーマンス予測**: AI予測の精度向上
- **個人化レコメンデーション**: 個人に最適化された提案
- **高度なダッシュボード**: より詳細な分析ツール
- **データ分析ツール**: 高度な統計分析機能

### AI機能の本格実装
- **AIタイム予測**: 精度3%以内のレースタイム予測
- **AIコーチング**: 週間プラン自動生成
- **怪我予防AI**: オーバートレーニング検出
- **パーソナライズ**: 個人に最適化されたAI機能

---

**最終更新**: 2025年1月27日  
**プロジェクト**: RunMaster (旧RacePredictor)  
**バージョン**: v2.2  
**ステータス**: データ収集版・本格運用準備完了
