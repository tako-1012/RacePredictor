# RunMaster 包括テスト・クリーンアップ実装ガイド

## 全体実装指示（6-7時間計画）

### Phase 1: AI機能テスト実行・確認（30分）
```
@codebase 実装済みのAI機能テストを実行して動作確認してください。

【実装済みテスト確認】
既に以下の11種類のテストが実装完了：
- test_ai_models.py - データベースモデル
- test_feature_extraction.py - 28種類の特徴量抽出
- test_ml_models.py - 4種類のMLモデル
- test_prediction_api.py - 予測API
- test_coaching_system.py - コーチング機能
- test_health_monitoring.py - ヘルスモニタリング
- test_background_tasks.py - バックグラウンドタスク
- test_performance.py - パフォーマンス
- test_accuracy_validation.py - 精度検証
- test_error_handling.py - エラーハンドリング
- test_ai_integration.py - 統合テスト

【実行確認】
./scripts/run_ai_tests.sh でテスト実行
- エラーなくパスするかの確認
- カバレッジ90%以上の達成確認
- パフォーマンス基準（1秒以内）の達成確認

【問題があれば】
- 失敗テストの原因特定と修正
- モックデータの調整
- 設定ファイルの修正

注意：AI機能テストは実装済みのため、実行確認のみでOK
```

### Phase 2: 既存機能の核心テスト実装（2時間）
```
@codebase 既存機能の最重要テストを実装してください。

【必須テスト実装】
1. tests/test_auth/test_auth_api.py
   - ユーザー登録・ログイン・JWT認証
   - パスワードセキュリティ
   - 不正アクセス防止

2. tests/test_workouts/test_workout_api.py
   - 練習記録CRUD操作
   - セッション分割型データ構造
   - 計算機能（距離・時間・ペース）

3. tests/test_dashboard/test_dashboard_api.py
   - 統計計算の正確性
   - グラフデータ生成
   - 週間目標管理

4. tests/test_csv/test_csv_import.py
   - Garmin CSVインポート
   - データ変換・エラーハンドリング
   - パフォーマンステスト

【品質基準】
- API エンドポイント基本動作100%確認
- セキュリティ脆弱性なし
- パフォーマンス劣化なし（既存機能）
- エラーハンドリング適切

DAILYLOGの実装履歴を参考に、確実に動作すべき機能を中心に実装
```

### Phase 3: 統合テスト・E2Eテスト（1.5時間）
```
@codebase 統合テスト・E2Eテストを実装してください。

【統合テスト】
tests/test_integration/test_user_journey.py
- 新規ユーザー登録 → プロフィール設定 → 練習記録 → ダッシュボード確認
- CSV インポート → データ確認 → レース結果登録
- AI機能（有効時）→ 予測実行 → 結果確認

【E2Eテスト（Playwright）】
tests/e2e/test_main_flows.py
- ブラウザでの主要ユーザーフローテスト
- レスポンシブデザイン確認
- エラー画面の表示確認

【パフォーマンステスト】
tests/test_performance/test_load.py
- 同時ユーザー負荷テスト（50ユーザー）
- 大量データ処理テスト
- メモリリーク検出

効率重視：重要フローのみに絞った実装
```

### Phase 4: プロジェクトクリーンアップ（1時間）
```
@codebase プロジェクトの包括的なクリーンアップを実行してください。

【不要ファイル・フォルダ削除】
1. 開発中の一時ファイル・ログファイル削除
2. 未使用のテンプレート・サンプルファイル削除
3. 重複したテストファイル・設定ファイル削除
4. バックアップファイル（*.bak, *.old等）削除
5. __pycache__、.pytest_cache、node_modules/*/削除

【コードリファクタリング】
1. 未使用のインポート文削除
2. 重複コードの統合
3. 長すぎる関数の分割
4. ハードコードされた値を定数化
5. タイプヒント不足の修正

【設定ファイル最適化】
1. requirements.txt の重複・未使用ライブラリ削除
2. Docker設定の最適化
3. 環境変数設定の整理
4. .gitignore の更新

【ドキュメント整理】
1. README.md の最新情報反映
2. 古いドキュメントファイル削除
3. API ドキュメント更新
4. DAILYLOG.md の最終更新

削除候補チェックリスト：
- backend/temp/
- frontend-react/public/temp/
- *.log, *.tmp ファイル
- 使われていないコンポーネント
- 旧バージョンのファイル
```

### Phase 5: 最終動作確認・最適化（1時間）
```
@codebase 最終動作確認と最適化を実行してください。

【動作確認】
1. クリーンアップ後の全機能動作テスト
2. AI機能有効・無効両方での動作確認
3. フロントエンド・バックエンド連携確認
4. データベースマイグレーション確認

【パフォーマンス最適化】
1. SQL クエリ最適化
2. 不要なAPI呼び出し削除
3. フロントエンドバンドルサイズ最適化
4. 画像・静的ファイル最適化

【セキュリティ最終チェック】
1. 機密情報の環境変数化確認
2. 不要な権限・エンドポイント削除
3. CORS設定の適正化
4. レート制限設定確認

【デプロイメント準備】
1. 本番環境設定ファイル確認
2. Docker設定最適化
3. 環境変数テンプレート更新
4. デプロイスクリプト更新

最終成果物：本番デプロイ可能な完全に整理されたプロジェクト
```

---

## 効率化のポイント

### テスト実装の優先順位
1. **AI機能の基本動作** - システム破壊を防ぐ
2. **認証・セキュリティ** - データ保護の確保
3. **核心機能（練習記録・ダッシュボード）** - ユーザー体験の確保
4. **統合・E2E** - 全体動作の確認

### クリーンアップの効果
- **ファイルサイズ削減** - デプロイ・開発速度向上
- **コード品質向上** - 保守性・可読性向上
- **セキュリティ強化** - 不要なコード削除による攻撃面削減
- **パフォーマンス向上** - 最適化による応答速度改善

### 時間配分の理由
- **AI機能テスト（1.5h）** - 新規実装のリスク軽減
- **既存機能テスト（2h）** - 品質保証の核心
- **統合テスト（1.5h）** - 全体動作の確認
- **クリーンアップ（1h）** - プロダクション品質の実現
- **最終確認（1h）** - デプロイメント準備完了

## 実装後の成果物

### テストカバレッジ
- バックエンドAPI: 90%以上
- 重要機能: 100%
- セキュリティ: 全脆弱性対応
- パフォーマンス: 基準値クリア

### プロジェクト品質
- コードの可読性・保守性向上
- 不要ファイル・重複コード削除
- 設定ファイル最適化
- ドキュメント最新化

### デプロイメント準備
- 本番環境対応完了
- セキュリティ設定完了
- パフォーマンス最適化完了
- 監視・ログ設定完了

この6-7時間の実装により、RunMasterは本格的なプロダクション環境でのデプロイが可能な品質レベルに到達します。

---

## 使用方法

1. **Phase 1から順次実行** - 各Phaseの完了を確認してから次へ
2. **エラー発生時** - 該当Phaseのみ個別に修正・再実行  
3. **時間調整** - 状況に応じてPhase内の作業量を調整
4. **最終確認** - 全Phase完了後に統合動作確認

各指示をCursorに貼り付けて段階的に実装してください。